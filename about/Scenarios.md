## Сценарии работы

### Двойной oauth2

1. OAUTH2_AUTHORIZATION_ENDPOINT - пользователь переходит сюда, ему создается сессия, в нее кладется redirect URL,
   поскольку пользователь не аутентифицирован в SSO, срабатывает EntryPoint и перенаправляется на страницу логина.
2. LOGIN_PAGE - здесь у пользователя есть кнопка на начала аутентификации через третью сторону.
3. THIRD_PARTY_AUTHORIZATION_ENDPOINT - через этот эндпоинт пользователь попадает на другой сайт для аутентификации.
4. THIRD_PARTY_CODE_ENDPOINT - после успешной аутентификации на другом сайте, пользователь переходит по этому эндпоинту
   с параметром код. И его сразу перенаправляют уже на точку входа клиента вместе с кодом для получения токена уже от
   SSO.
5. OAUTH2_TOKEN_ENDPOINT - уже на клиенте, имея код, пользователь должен обменять этот код на токен.
6. TOKEN_INTROSPECTION_ENDPOINT - а тут пользователь может проверить валидность своего токена.

### Регистрация

Много информации в закрытом [тикете](https://github.com/timattt/TypeSix/issues/9) по теме

1. LOGIN_PAGE - здесь есть кнопка регистрации.
2. REGISTRATION_EMAIL_PAGE - нажимая на эту кнопку, пользователь переходит на страницу ввода почты.
3. REGISTRATION_EMAIL_ENDPOINT - после ввода почты, пользователь делает запрос на этот эндпоинт и конвейер начинает работать. Отправляется письмо с кодом на почту пользователя через [type-10](https://github.com/timattt/typeten).
4. REGISTRATION_CODE_PAGE - после пользователь попадает на страницу ввода кода из сообщения.
5. REGISTRATION_CODE_ENDPOINT - вводя код, пользователь попадает на этот эндпоинт, происходит второй шаг конвейера.
6. REGISTRATION_PASSWORD_SET_PAGE - если все хорошо, пользователь переходит сюда. И вводит пароль.
7. REGISTRATION_PASSWORD_SET_PAGE - установка пароля и завершение конвейера происходит здесь. После пользователь возвращается в начало.

### Одинарный oauth2

1. OAUTH2_AUTHORIZATION_ENDPOINT - пользователь переходит сюда, ему создается сессия, в нее кладется redirect URL,
   поскольку пользователь не аутентифицирован в SSO, срабатывает EntryPoint и перенаправляется на страницу логина.
2. LOGIN_PAGE - здесь у пользователя есть форма для ввода логина и пароля.
3. FORM_LOGIN_ENDPOINT - после ввода логина и пароля, активируется этот эндпоинт. Если все хорошо, то сессия
   подтверждена и пользователя перенаправляют обратно к себе вместе с кодом.
4. OAUTH2_TOKEN_ENDPOINT - уже на клиенте, имея код, пользователь должен обменять этот код на токен.
5. TOKEN_INTROSPECTION_ENDPOINT - а тут пользователь может проверить валидность своего токена.
